# Применение
```
git clone https://github.com/direbcg/2025-07-22---pg_dump
cd 2025-07-22---pg_dump/
chmod +x db-backup.sh
# Запуск
./db-backup.sh
```

# ⁠Краткое описание скрипта и его назначения:

1.⁠ ⁠Создаёт дамп базы данных (PostgreSQL или MariaDB), используя параметры, указанные в .env файле.

2.⁠ ⁠Сохраняет архив в директорию /opt/backups в формате "<db_name>-YYYY-MM-DD_HH-MM.sql.gz".

3.⁠ ⁠Хранит только последние 7 резервных копий, удаляя более старые.

4.⁠ ⁠Логирует действия в файл /var/log/db-backup.log, включая:

•⁠  ⁠дату и время выполнения;

•⁠  ⁠статус (успешно / с ошибкой);

•⁠  ⁠размер файла дампа.


# ⁠Как настроить .env:

Отредактировать файл db.env, внеся в него свои данные

#⁠ ⁠Как установить зависимости:

Для работы скрипта необходимы БД postgres или mariaDB. Пример установки:
```
# Debian / Ubuntu
apt install postgresql-client
# CentOS / Fedora
sudo yum install postgresql
```
Скрипт и .env положить в папку /opt
Структура:
```
/opt/db-backup.sh
/opt/db.env
```
Дать права на запуск скрипта:
```
chmod +x /opt/db-backup.sh
```

#⁠ ⁠Примеры вывода логов: 
```
2025-07-22_17-01: Ошибка дампа БД zabbix
2025-07-22_17-02: Ошибка дампа БД zabbix
2025-07-22_17-08: Дамп БД zabbix выполнен. Размер: 185M
```
#⁠ ⁠Как добавить задание в cron для ежедневного запуска:

Добавляем задание в cron ежедневно в 23-00
```
0 23    * * *   root    test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.daily; }
```

